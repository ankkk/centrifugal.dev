"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[2469],{3905:(e,t,i)=>{i.d(t,{Zo:()=>c,kt:()=>f});var o=i(7294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,o,n=function(e,t){if(null==e)return{};var i,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)i=a[o],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)i=a[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=o.createContext({}),d=function(e){var t=o.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):r(r({},t),e)),i},c=function(e){var t=d(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var i=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(i),f=n,m=u["".concat(l,".").concat(f)]||u[f]||p[f]||a;return i?o.createElement(m,r(r({ref:t},c),{},{components:i})):o.createElement(m,r({ref:t},c))}));function f(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=i.length,r=new Array(a);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,r[1]=s;for(var d=2;d<a;d++)r[d]=i[d];return o.createElement.apply(null,r)}return o.createElement.apply(null,i)}u.displayName="MDXCreateElement"},9323:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var o=i(3117),n=(i(7294),i(3905));const a={id:"push_notifications",sidebar_label:"Push notification API",title:"Push notification API (coming soon)"},r=void 0,s={unversionedId:"pro/push_notifications",id:"pro/push_notifications",title:"Push notification API (coming soon)",description:"Centifugo is good in delivering real-time in-app messages to online users. Sometimes though you need a way to engage offline users to come back to your app. Or trigger some update in the app when it's running in the background. That's where push notifications may be used. Push notifications delivered over battery-efficient platform dependent transport. Usually integrating push notifications into the app is quite time-consuming. There are some popular cloud solutions which simplify this. The situation is a bit harder when it comes to self-hosted solutions.",source:"@site/docs/pro/push_notifications.md",sourceDirName:"pro",slug:"/pro/push_notifications",permalink:"/docs/pro/push_notifications",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/pro/push_notifications.md",tags:[],version:"current",frontMatter:{id:"push_notifications",sidebar_label:"Push notification API",title:"Push notification API (coming soon)"},sidebar:"Pro",previous:{title:"Token revocation API",permalink:"/docs/pro/token_revocation"},next:{title:"Faster performance",permalink:"/docs/pro/performance"}},l={},d=[{value:"Motivation",id:"motivation",level:2},{value:"Steps to integrate",id:"steps-to-integrate",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Tutorial",id:"tutorial",level:2},{value:"API description",id:"api-description",level:2},{value:"device_register",id:"device_register",level:3},{value:"device_register params",id:"device_register-params",level:4},{value:"device_register result",id:"device_register-result",level:4},{value:"device_remove",id:"device_remove",level:3},{value:"device_remove params",id:"device_remove-params",level:4},{value:"device_remove result",id:"device_remove-result",level:4},{value:"device_list",id:"device_list",level:3},{value:"device_list params",id:"device_list-params",level:4},{value:"device_list result",id:"device_list-result",level:4},{value:"device_subscription_add",id:"device_subscription_add",level:3},{value:"device_subscription_add params",id:"device_subscription_add-params",level:4},{value:"device_subscription_add result",id:"device_subscription_add-result",level:4},{value:"device_subscription_remove",id:"device_subscription_remove",level:3},{value:"device_subscription_remove params",id:"device_subscription_remove-params",level:4},{value:"device_subscription_remove result",id:"device_subscription_remove-result",level:4},{value:"device_subscription_list",id:"device_subscription_list",level:3},{value:"device_subscription_list params",id:"device_subscription_list-params",level:4},{value:"device_subscription_list result",id:"device_subscription_list-result",level:4},{value:"send_push_notification",id:"send_push_notification",level:3},{value:"send_push_notification params",id:"send_push_notification-params",level:4},{value:"send_push_notification result",id:"send_push_notification-result",level:4}],c={toc:d};function p(e){let{components:t,...i}=e;return(0,n.kt)("wrapper",(0,o.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Centifugo is good in delivering real-time in-app messages to online users. Sometimes though you need a way to engage offline users to come back to your app. Or trigger some update in the app when it's running in the background. That's where push notifications may be used. Push notifications delivered over battery-efficient platform dependent transport. Usually integrating push notifications into the app is quite time-consuming. There are some popular cloud solutions which simplify this. The situation is a bit harder when it comes to self-hosted solutions."),(0,n.kt)("p",null,"Centrifugo PRO provides API to manage user device tokens, device channel subscriptions and to send push notifications towards registered devices and group of devices (subscribed on a channel). Centrifugo PRO sends push notifications by integrating with ",(0,n.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging"},"Firebase Cloud Messaging (FCM)")," API."),(0,n.kt)("p",null,"FCM is ",(0,n.kt)("strong",{parentName:"p"},"free to use")," and provides a way to send notifications to the following platforms in a unified way:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("i",{className:"bi bi-apple",style:{color:"cornflowerblue"}})," iOS devices (over APNs)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("i",{className:"bi bi-android2",style:{color:"yellowgreen"}})," Android devices (over FCM)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("i",{className:"bi bi-globe",style:{color:"orange"}})," Web browsers which support Web Push API (Chrome, Firefox, see ",(0,n.kt)("a",{href:"https://caniuse.com/push-api"},"this matrix"),")")),(0,n.kt)("p",null,"FCM is only a transport for push notifications, tokens should be stored in the application database. Centrifugo PRO provides an API to store tokens in database (PostgreSQL), manage device subscriptions to channels (replacing native FCM topics functionality \u2013 see motivation below)."),(0,n.kt)("p",null,"Centrifugo PRO comes with super efficient worker queues (based on Redis streams) which allow broadcasting push notifications towards devices in a very efficient way."),(0,n.kt)("p",null,"Integration with FCM means that you can use existing Firebase messaging SDKs to extract push notification token for a device on different platforms (iOS, Android, Flutter, web browser) and setting up push notification listeners. Only a couple of additional steps required to integrate frontend with Centrifugo PRO device token and device subscription storage. After doing that you will be able to send push notification towards single device, or towards devices subscribed to a channel with a simple API call like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST http://localhost:8000/api -d \\\n\'{"method": "send_push_notification", "params": {"recipient": {"channels": ["test"]}, "notification": {"fcm": {"notification": {"title": "Hello", "body": "How are you?"}}}}}\'\n')),(0,n.kt)("h2",{id:"motivation"},"Motivation"),(0,n.kt)("p",null,"Our goals introducing push notification API in Centrifugo PRO were:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Simplify adding push notifications to the project. FCM SDKs solve the frontend part \u2013 giving a unified way to load push token for all popular platforms and a way to set notification handlers. FCM also provides a unified transport layer for all the platforms. But the backend part (token storage and management) is still need to be implemented by application. Centrifugo PRO provides the required backend, it tries to follow best practices when working with FCM maintaining only an actual set of device tokens, reacting on FCM errors and periodically removing stale devices."),(0,n.kt)("li",{parentName:"ul"},"FCM provides API to send push notifications. Centrifugo just wraps it, but at the same time provides efficient queuing. So you can send notifications from your app with minimal latency, and let Centrifugo process sending to FCM for you."),(0,n.kt)("li",{parentName:"ul"},"FCM has a built-in way of sending notification to large groups of devices over ",(0,n.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/cloud-messaging/android/topic-messaging"},"topics")," mechanism. The problem with native FCM topics though is that client can subscribe to any topic from the frontend side without any permission check. In today's world this is usually not desired. So Centrifugo PRO re-implements FCM topics by introducing an additional API to manage device subscriptions to channels. We intentionally called it ",(0,n.kt)("inlineCode",{parentName:"li"},"channels")," to make the concept closer to our real-time API. In some cases you may have real-time channels and device subscription channels with matching names \u2013 to send messages to both online and offline users. Though it's up to you.")),(0,n.kt)("p",null,"Apart from this you get a possibility to inspect sent push notifications over our ClickHouse analytics. Also, FCM provides ",(0,n.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/understand-delivery?platform=web"},"its own analytics")," from which you can get insight into push notification delivery."),(0,n.kt)("p",null,"BTW, in our API we left a possibility to publish notifications into FCM topics or sending to raw FCM tokens, so you can combine native FCM primitives with those provided by Centrifugo."),(0,n.kt)("h2",{id:"steps-to-integrate"},"Steps to integrate"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Add FCM SDK on the frontend side, follow FCM instructions for your platform to obtain a push token for a device (see ",(0,n.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/cloud-messaging/ios/client"},"iOS"),", ",(0,n.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/cloud-messaging/android/client"},"Android"),", ",(0,n.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/cloud-messaging/flutter/client"},"Flutter"),", ",(0,n.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/cloud-messaging/js/client"},"Web Browser"),"). So all the frontend part is left to FCM libraries."),(0,n.kt)("li",{parentName:"ol"},"Call your backend API with the obtained token, from the backend call Centrifugo ",(0,n.kt)("inlineCode",{parentName:"li"},"device_register")," API to register the device in Centrifugo PRO storage."),(0,n.kt)("li",{parentName:"ol"},"Centrifugo returns a registered device object, pass a generated device ID to the frontend and save it on the frontend together with a token received from FCM."),(0,n.kt)("li",{parentName:"ol"},"Subscribe device to the required set of channels, first by calling your backend with device ID and list of channels, check channel permissions and then call Centrifugo ",(0,n.kt)("inlineCode",{parentName:"li"},"device_subscription_add")," API."),(0,n.kt)("li",{parentName:"ol"},"Call Centrifugo ",(0,n.kt)("inlineCode",{parentName:"li"},"send_push_notification")," API whenever it's time to deliver a push notification.")),(0,n.kt)("p",null,"At any moment you can inspect device and subscription storage by calling ",(0,n.kt)("inlineCode",{parentName:"p"},"device_list")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"device_subscription_list")," APIs."),(0,n.kt)("p",null,"Also, you can remove unnecessary by using ",(0,n.kt)("inlineCode",{parentName:"p"},"device_remove")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"device_subscription_remove")," APIs."),(0,n.kt)("h2",{id:"configuration"},"Configuration"),(0,n.kt)("p",null,"Coming soon."),(0,n.kt)("h2",{id:"tutorial"},"Tutorial"),(0,n.kt)("p",null,"Coming soon."),(0,n.kt)("h2",{id:"api-description"},"API description"),(0,n.kt)("h3",{id:"device_register"},"device_register"),(0,n.kt)("p",null,"Registers or updates device information."),(0,n.kt)("h4",{id:"device_register-params"},"device_register params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L485"},"Proto definitions"),"."),(0,n.kt)("h4",{id:"device_register-result"},"device_register result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/master/internal/apiproto/api.proto#L558"},"Proto definitions"),"."),(0,n.kt)("h3",{id:"device_remove"},"device_remove"),(0,n.kt)("p",null,"Removes device from storage."),(0,n.kt)("h4",{id:"device_remove-params"},"device_remove params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L493"},"Proto definitions"),"."),(0,n.kt)("h4",{id:"device_remove-result"},"device_remove result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L562"},"Proto definitions"),"."),(0,n.kt)("h3",{id:"device_list"},"device_list"),(0,n.kt)("p",null,"Returns a paginated list of registered devices according to request filter conditions."),(0,n.kt)("h4",{id:"device_list-params"},"device_list params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L498"},"Proto definitions"),"."),(0,n.kt)("h4",{id:"device_list-result"},"device_list result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L565"},"Proto definitions"),"."),(0,n.kt)("h3",{id:"device_subscription_add"},"device_subscription_add"),(0,n.kt)("p",null,"Subscribes device to the provided list of channels."),(0,n.kt)("h4",{id:"device_subscription_add-params"},"device_subscription_add params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L508"},"Proto definitions"),"."),(0,n.kt)("h4",{id:"device_subscription_add-result"},"device_subscription_add result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L579"},"Proto definitions"),"."),(0,n.kt)("h3",{id:"device_subscription_remove"},"device_subscription_remove"),(0,n.kt)("p",null,"Unsubscribes device from the provided list of channels."),(0,n.kt)("h4",{id:"device_subscription_remove-params"},"device_subscription_remove params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L513"},"Proto definitions")),(0,n.kt)("h4",{id:"device_subscription_remove-result"},"device_subscription_remove result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L582"},"Proto definitions")),(0,n.kt)("h3",{id:"device_subscription_list"},"device_subscription_list"),(0,n.kt)("p",null,"Returns a paginated list of device subscriptions according to request filter conditions."),(0,n.kt)("h4",{id:"device_subscription_list-params"},"device_subscription_list params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L518"},"Proto definitions")),(0,n.kt)("h4",{id:"device_subscription_list-result"},"device_subscription_list result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L585"},"Proto definitions")),(0,n.kt)("h3",{id:"send_push_notification"},"send_push_notification"),(0,n.kt)("p",null,"Send push notification to specific ",(0,n.kt)("inlineCode",{parentName:"p"},"device_ids"),", or to ",(0,n.kt)("inlineCode",{parentName:"p"},"channels"),", or ",(0,n.kt)("inlineCode",{parentName:"p"},"fcm_tokens"),", or to ",(0,n.kt)("inlineCode",{parentName:"p"},"fcm_topic"),". Request will be queued by Centrifugo, consumed by Centrifugo built-in workers and sent to FCM API."),(0,n.kt)("h4",{id:"send_push_notification-params"},"send_push_notification params"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L700"},"Proto definitions")),(0,n.kt)("h4",{id:"send_push_notification-result"},"send_push_notification result"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/157d3a7da9bdae5b6274da99473deee25f158e40/internal/apiproto/api.proto#L712"},"Proto definitions")))}p.isMDXComponent=!0}}]);